<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="application-usage-mcp-system">Application Usage MCP System</h1>
<h2 id="1-project-overview">1. Project Overview</h2>
<p>The <strong>Application Usage MCP System</strong> is a production-ready implementation of the Model Context Protocol (MCP) designed for tracking and managing application usage data. This system provides a secure, standards-compliant interface that enables AI assistants to interact with application usage logs through a well-defined protocol.</p>
<h3 id="key-features">Key Features:</h3>
<ul>
<li><strong>Full MCP Protocol Compliance</strong>: Implements the official MCP specification with JSON-RPC 2.0</li>
<li><strong>Secure Operations</strong>: Input validation, schema validation, and explicit command whitelisting</li>
<li><strong>Tool System</strong>: Database operations exposed as standardized MCP tools</li>
<li><strong>Resource System</strong>: Real-time usage statistics accessible as MCP resources</li>
<li><strong>Database Management</strong>: SQLite database with automatic schema migration</li>
<li><strong>Async Architecture</strong>: Built on Python's asyncio for high performance</li>
<li><strong>Comprehensive Testing</strong>: Full test suite ensuring protocol compliance</li>
</ul>
<hr>
<h2 id="2-quick-start-guide">2. Quick Start Guide</h2>
<h3 id="%F0%9F%9A%80-interactive-client-recommended">ğŸš€ Interactive Client (Recommended)</h3>
<p>The easiest way to test and explore all MCP functionality is through the interactive client:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 1. Start the MCP server (in one terminal)</span>
<span class="hljs-built_in">cd</span> examples
python start_server.py

<span class="hljs-comment"># 2. Run the interactive client (in another terminal)</span>
<span class="hljs-built_in">cd</span> examples
python interactive_client.py
</div></code></pre>
<p>The interactive client provides a menu-driven interface to test all MCP tools:</p>
<pre class="hljs"><code><div>ğŸ› ï¸  MCP CLIENT INTERACTIVE TOOL TESTER
============================================================
1ï¸âƒ£  Create Usage Log           6ï¸âƒ£  Get Unique Users
2ï¸âƒ£  Get Usage Logs (All)       7ï¸âƒ£  Get Unique Applications
3ï¸âƒ£  Get Usage Logs (Filtered)  8ï¸âƒ£  Get Unique Platforms
4ï¸âƒ£  Update Usage Log           9ï¸âƒ£  Get Usage Statistics
5ï¸âƒ£  Delete Usage Log           ğŸ”Ÿ  Test Duration Aggregation
ğŸ“Š  Show All Data Summary       ğŸ§ª  Run All Tests (Auto)
âŒ  Exit
============================================================
</div></code></pre>
<p><strong>Features:</strong></p>
<ul>
<li><strong>Smart Defaults</strong>: Quick testing with sensible default values</li>
<li><strong>Input Validation</strong>: Type checking and format validation</li>
<li><strong>Duration Aggregation</strong>: Test automatic duration aggregation for duplicates</li>
<li><strong>Comprehensive Testing</strong>: Automated test suite for all functionality</li>
<li><strong>User-Friendly</strong>: Clear prompts and formatted output</li>
</ul>
<h3 id="%F0%9F%93%8B-manual-testing">ğŸ“‹ Manual Testing</h3>
<p>The interactive client includes comprehensive automated testing options (menu option ğŸ§ª).</p>
<h3 id="%F0%9F%93%9A-documentation">ğŸ“š Documentation</h3>
<ul>
<li><strong>Interactive Interface</strong>: The <code>interactive_client.py</code> includes built-in help and guidance</li>
<li><strong>Architecture Details</strong>: Continue reading this README for technical details</li>
</ul>
<hr>
<h2 id="3-folder-structure">3. Folder Structure</h2>
<pre class="hljs"><code><div>application_usage_mcp/
â”œâ”€â”€ README.md                           # This documentation file
â”œâ”€â”€ requirements.txt                    # Python dependencies
â”œâ”€â”€ main.py                            # Application entry point
â”œâ”€â”€ usage.db                           # SQLite database (auto-created)
â”‚
â”œâ”€â”€ config/                            # Configuration management
â”‚   â”œâ”€â”€ __init__.py                    # Package initialization
â”‚   â””â”€â”€ settings.py                    # Application settings and constants
â”‚
â”œâ”€â”€ database/                          # Database layer
â”‚   â”œâ”€â”€ __init__.py                    # Package initialization
â”‚   â”œâ”€â”€ db_manager.py                  # Database operations manager
â”‚   â””â”€â”€ schema.sql                     # Database schema definition
â”‚
â”œâ”€â”€ mcp/                               # MCP protocol implementation
â”‚   â”œâ”€â”€ __init__.py                    # Package initialization
â”‚   â”œâ”€â”€ mcp_server.py                  # MCP protocol server
â”‚   â””â”€â”€ mcp_client.py                  # MCP protocol client
â”‚
â”œâ”€â”€ schemas/                           # JSON schema validation
â”‚   â”œâ”€â”€ __init__.py                    # Package initialization
â”‚   â”œâ”€â”€ validator.py                   # Schema validation utilities
â”‚   â”œâ”€â”€ initialize_request.json        # Initialize request schema
â”‚   â”œâ”€â”€ tool_call_request.json         # Tool call request schema
â”‚   â””â”€â”€ resource_read_request.json     # Resource read request schema
â”‚
â””â”€â”€ examples/                          # Usage examples and utilities
    â”œâ”€â”€ start_server.py                # Server startup script
    â””â”€â”€ interactive_client.py          # Interactive CLI for testing all tools
</div></code></pre>
<h3 id="folder-purposes">Folder Purposes:</h3>
<ul>
<li><strong><code>config/</code></strong>: Contains application configuration and settings</li>
<li><strong><code>database/</code></strong>: Database abstraction layer and schema management</li>
<li><strong><code>mcp/</code></strong>: Core MCP protocol implementation (server and client)</li>
<li><strong><code>schemas/</code></strong>: JSON schema definitions for request validation</li>
<li><strong><code>examples/</code></strong>: Practical usage examples and helper scripts</li>
</ul>
<hr>
<h2 id="4-documentation">4. Documentation</h2>
<h3 id="core-files-documentation">Core Files Documentation</h3>
<h4 id="mainpy"><code>main.py</code></h4>
<p><strong>Purpose</strong>: Application entry point that initializes and starts the MCP server.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Functionality:</span>
- Configures logging
- Initializes MCPServer instance
- Starts the <span class="hljs-keyword">async</span> event loop
- Handles graceful shutdown
</div></code></pre>
<h4 id="configsettingspy"><code>config/settings.py</code></h4>
<p><strong>Purpose</strong>: Centralized configuration management for the entire application.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Configuration includes:</span>
- Database settings (path, name, schema location)
- MCP server settings (host, port)
- Protocol constants <span class="hljs-keyword">and</span> defaults
</div></code></pre>
<h4 id="databasedbmanagerpy"><code>database/db_manager.py</code></h4>
<p><strong>Purpose</strong>: Database abstraction layer providing CRUD operations for usage logs.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Key Methods:</span>
- initialize_database(): Sets up database schema
- create_usage_log(): Creates new usage entries
- get_usage_logs(): Retrieves logs <span class="hljs-keyword">with</span> optional filtering
- update_usage_log(): Updates existing log entries
- delete_usage_log(): Removes log entries
</div></code></pre>
<h3 id="database-schema">Database Schema</h3>
<p>The database uses the following schema for tracking application usage across different platforms and applications:</p>
<h4 id="table-usagedata">Table: <code>usage_data</code></h4>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PRIMARY KEY AUTOINCREMENT</td>
<td>Unique identifier for each usage record</td>
</tr>
<tr>
<td><code>monitor_app_version</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Version of the monitoring tool that logged the data</td>
</tr>
<tr>
<td><code>platform</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Operating system (e.g., Windows, macOS, Android)</td>
</tr>
<tr>
<td><code>user</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Username or device ID</td>
</tr>
<tr>
<td><code>application_name</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Name of the application (e.g., chrome.exe)</td>
</tr>
<tr>
<td><code>application_version</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Application version number</td>
</tr>
<tr>
<td><code>log_date</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Date in YYYY-MM-DD format</td>
</tr>
<tr>
<td><code>legacy_app</code></td>
<td>BOOLEAN</td>
<td>NOT NULL</td>
<td>Indicates if the application is legacy (true/false)</td>
</tr>
<tr>
<td><code>duration_seconds</code></td>
<td>INTEGER</td>
<td>NOT NULL</td>
<td>Usage time in seconds</td>
</tr>
</tbody>
</table>
<h4 id="database-indexes">Database Indexes</h4>
<table>
<thead>
<tr>
<th>Index Name</th>
<th>Column(s)</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idx_usage_app</code></td>
<td><code>application_name</code></td>
<td>Efficient application-based queries</td>
</tr>
<tr>
<td><code>idx_usage_user</code></td>
<td><code>user</code></td>
<td>User-based filtering and analytics</td>
</tr>
<tr>
<td><code>idx_usage_date</code></td>
<td><code>log_date</code></td>
<td>Time-based queries and reporting</td>
</tr>
<tr>
<td><code>idx_usage_platform</code></td>
<td><code>platform</code></td>
<td>Platform-specific analysis</td>
</tr>
</tbody>
</table>
<h4 id="example-data">Example Data</h4>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"id"</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">"monitor_app_version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"platform"</span>: <span class="hljs-string">"Windows"</span>,
  <span class="hljs-attr">"user"</span>: <span class="hljs-string">"john_doe"</span>,
  <span class="hljs-attr">"application_name"</span>: <span class="hljs-string">"chrome.exe"</span>,
  <span class="hljs-attr">"application_version"</span>: <span class="hljs-string">"119.0.6045.105"</span>,
  <span class="hljs-attr">"log_date"</span>: <span class="hljs-string">"2025-07-27"</span>,
  <span class="hljs-attr">"legacy_app"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"duration_seconds"</span>: <span class="hljs-number">3600</span>
}
</div></code></pre>
<h4 id="query-examples">Query Examples</h4>
<pre class="hljs"><code><div><span class="hljs-comment">-- Get all Chrome usage logs</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> usage_data <span class="hljs-keyword">WHERE</span> application_name = <span class="hljs-string">'chrome.exe'</span>;

<span class="hljs-comment">-- Get usage logs for a specific user on Windows</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> usage_data <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">user</span> = <span class="hljs-string">'john_doe'</span> <span class="hljs-keyword">AND</span> platform = <span class="hljs-string">'Windows'</span>;

<span class="hljs-comment">-- Get legacy applications only</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> usage_data <span class="hljs-keyword">WHERE</span> legacy_app = <span class="hljs-number">1</span>;

<span class="hljs-comment">-- Get usage logs from the last 24 hours</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> usage_data 
<span class="hljs-keyword">WHERE</span> log_date &gt;= datetime(<span class="hljs-string">'now'</span>, <span class="hljs-string">'-1 day'</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> log_date <span class="hljs-keyword">DESC</span>;

<span class="hljs-comment">-- Get total usage time per application</span>
<span class="hljs-keyword">SELECT</span> application_name, <span class="hljs-keyword">SUM</span>(duration_seconds) <span class="hljs-keyword">as</span> total_seconds
<span class="hljs-keyword">FROM</span> usage_data 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> application_name 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> total_seconds <span class="hljs-keyword">DESC</span>;
</div></code></pre>
<h4 id="mcpmcpserverpy"><code>mcp/mcp_server.py</code></h4>
<p><strong>Purpose</strong>: Complete MCP protocol server implementation with JSON-RPC 2.0 compliance.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Key Components:</span>
- MCPServer <span class="hljs-class"><span class="hljs-keyword">class</span>:</span> Main server implementation
- Message handling: Process all MCP message types
- Tool system: Expose database operations <span class="hljs-keyword">as</span> MCP tools
- Resource system: Provide usage statistics <span class="hljs-keyword">as</span> resources
- Security: Input validation <span class="hljs-keyword">and</span> error handling
</div></code></pre>
<h4 id="mcpmcpclientpy"><code>mcp/mcp_client.py</code></h4>
<p><strong>Purpose</strong>: MCP protocol client for interacting with the server programmatically.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Key Features:</span>
- Connection management <span class="hljs-keyword">with</span> auto-reconnection
- Protocol handshake <span class="hljs-keyword">and</span> initialization
- Tool discovery <span class="hljs-keyword">and</span> execution
- Resource reading capabilities
- Convenience methods <span class="hljs-keyword">for</span> database operations
</div></code></pre>
<h4 id="schemasvalidatorpy"><code>schemas/validator.py</code></h4>
<p><strong>Purpose</strong>: JSON schema validation utilities for ensuring message compliance.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Validation Functions:</span>
- validate_initialize_request(): Validates handshake messages
- validate_tool_call_request(): Validates tool execution requests
- validate_resource_read_request(): Validates resource access requests
</div></code></pre>
<hr>
<h2 id="5-architecture">5. Architecture</h2>
<h3 id="system-architecture-overview">System Architecture Overview</h3>
<p>The system follows a <strong>layered architecture</strong> with clear separation of concerns:</p>
<pre class="hljs"><code><div>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP CLIENT LAYER                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   AI Assistant  â”‚  â”‚  Python Client  â”‚  â”‚  Web Client  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ JSON-RPC 2.0 / TCP
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MCP SERVER LAYER                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 MCPServer                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Message    â”‚  â”‚   Tool      â”‚  â”‚    Resource     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Handler    â”‚  â”‚   System    â”‚  â”‚    System       â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Method Calls
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DATABASE LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               DatabaseManager                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚  â”‚   CRUD      â”‚  â”‚   Connection    â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚ Operations  â”‚  â”‚   Manager       â”‚                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ SQL
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STORAGE LAYER                             â”‚
â”‚                    SQLite Database                          â”‚
â”‚                     (usage.db)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</div></code></pre>
<h3 id="class-diagram-ascii-art">Class Diagram (ASCII Art)</h3>
<pre class="hljs"><code><div>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MCPServer                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - host: str                                                 â”‚
â”‚ - port: int                                                 â”‚
â”‚ - db_manager: DatabaseManager                               â”‚
â”‚ - initialized: bool                                         â”‚
â”‚ - tools: Dict[str, Dict]                                    â”‚
â”‚ - resources: Dict[str, Dict]                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + handle_client(reader, writer)                             â”‚
â”‚ + process_message(message) -&gt; Dict                          â”‚
â”‚ + handle_initialize(id, params) -&gt; Dict                     â”‚
â”‚ + handle_tools_list(id) -&gt; Dict                             â”‚
â”‚ + handle_tools_call(id, params) -&gt; Dict                     â”‚
â”‚ + handle_resources_list(id) -&gt; Dict                         â”‚
â”‚ + handle_resources_read(id, params) -&gt; Dict                 â”‚
â”‚ + start()                                                   â”‚
â”‚ + shutdown()                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ uses
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DatabaseManager                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - db_path: str                                              â”‚
â”‚ - conn: sqlite3.Connection                                  â”‚
â”‚ - logger: Logger                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + connect()                                                 â”‚
â”‚ + disconnect()                                              â”‚
â”‚ + initialize_database()                                     â”‚
â”‚ + create_usage_log(data) -&gt; int                             â”‚
â”‚ + get_usage_logs(filters) -&gt; List[Dict]                     â”‚
â”‚ + update_usage_log(id, updates) -&gt; bool                     â”‚
â”‚ + delete_usage_log(id) -&gt; bool                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ creates/manages
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MCPClient                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - host: str                                                 â”‚
â”‚ - port: int                                                 â”‚
â”‚ - reader: StreamReader                                      â”‚
â”‚ - writer: StreamWriter                                      â”‚
â”‚ - initialized: bool                                         â”‚
â”‚ - available_tools: List[Dict]                               â”‚
â”‚ - available_resources: List[Dict]                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + connect() -&gt; bool                                         â”‚
â”‚ + disconnect()                                              â”‚
â”‚ + initialize() -&gt; bool                                      â”‚
â”‚ + send_request(request) -&gt; Dict                             â”‚
â”‚ + call_tool(name, args) -&gt; Dict                             â”‚
â”‚ + read_resource(uri) -&gt; Dict                                â”‚
â”‚ + create_usage_log(data) -&gt; int                             â”‚
â”‚ + get_usage_logs(filters) -&gt; List[Dict]                     â”‚
â”‚ + update_usage_log(id, updates) -&gt; bool                     â”‚
â”‚ + delete_usage_log(id) -&gt; bool                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ validates with
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SchemaValidator                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - schemas: Dict[str, Dict]                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + validate_message(message, schema) -&gt; Optional[str]        â”‚
â”‚ + validate_initialize_request(message) -&gt; Optional[str]     â”‚
â”‚ + validate_tool_call_request(message) -&gt; Optional[str]      â”‚
â”‚ + validate_resource_read_request(message) -&gt; Optional[str]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</div></code></pre>
<h3 id="component-relationships">Component Relationships</h3>
<ol>
<li><strong>MCPServer</strong> â†” <strong>DatabaseManager</strong>: Server uses database manager for all data operations</li>
<li><strong>MCPClient</strong> â†’ <strong>MCPServer</strong>: Client communicates with server via JSON-RPC 2.0</li>
<li><strong>MCPServer</strong> â†’ <strong>SchemaValidator</strong>: Server validates all incoming messages</li>
<li><strong>DatabaseManager</strong> â†’ <strong>SQLite</strong>: Direct database operations and connection management</li>
<li><strong>MCPClient</strong> â†” <strong>MCPServer</strong>: Bidirectional communication for tools and resources</li>
</ol>
<hr>
<h2 id="5-deployment-instructions">5. Deployment Instructions</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Python 3.8 or higher</li>
<li>pip package manager</li>
<li>50MB available disk space</li>
</ul>
<h3 id="step-by-step-deployment">Step-by-Step Deployment</h3>
<h4 id="step-1-clone-the-repository">Step 1: Clone the Repository</h4>
<pre class="hljs"><code><div>git <span class="hljs-built_in">clone</span> https://github.com/yourusername/application_usage_mcp.git
<span class="hljs-built_in">cd</span> application_usage_mcp
</div></code></pre>
<h4 id="step-2-install-dependencies">Step 2: Install Dependencies</h4>
<pre class="hljs"><code><div>pip install -r requirements.txt
</div></code></pre>
<h4 id="step-3-start-the-server">Step 3: Start the Server</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Option 1: Using the main entry point</span>
python main.py

<span class="hljs-comment"># Option 2: Using the example server script</span>
python examples/start_server.py
</div></code></pre>
<h4 id="step-4-verify-server-is-running">Step 4: Verify Server is Running</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># In a new terminal, run the client example</span>
python examples/client_usage.py
</div></code></pre>
<h4 id="step-5-configure-optional">Step 5: Configure (Optional)</h4>
<p>Edit <code>config/settings.py</code> to customize:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Change server port</span>
MCP_PORT = <span class="hljs-number">9000</span>

<span class="hljs-comment"># Change database location</span>
DB_PATH = <span class="hljs-string">"/path/to/your/database.db"</span>
</div></code></pre>
<h3 id="production-deployment">Production Deployment</h3>
<h4 id="docker-deployment-recommended">Docker Deployment (Recommended)</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.11</span>-slim

<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>
<span class="hljs-keyword">COPY</span><span class="bash"> . .</span>
<span class="hljs-keyword">RUN</span><span class="bash"> pip install -r requirements.txt</span>

<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">58888</span>
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">"python"</span>, <span class="hljs-string">"main.py"</span>]</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment"># Build and run</span>
docker build -t mcp-usage-tracker .
docker run -p 58888:58888 -v $(<span class="hljs-built_in">pwd</span>)/data:/app/data mcp-usage-tracker
</div></code></pre>
<h4 id="systemd-service-linux">Systemd Service (Linux)</h4>
<pre class="hljs"><code><div><span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=MCP Usage Tracker
<span class="hljs-attr">After</span>=network.target

<span class="hljs-section">[Service]</span>
<span class="hljs-attr">Type</span>=simple
<span class="hljs-attr">User</span>=mcp-user
<span class="hljs-attr">WorkingDirectory</span>=/opt/mcp-usage-tracker
<span class="hljs-attr">ExecStart</span>=/usr/bin/python3 main.py
<span class="hljs-attr">Restart</span>=always

<span class="hljs-section">[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target
</div></code></pre>
<h3 id="health-check">Health Check</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Test server connectivity</span>
curl -X POST http://localhost:58888 \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"jsonrpc":"2.0","id":"1","method":"ping"}'</span>
</div></code></pre>
<hr>
<h2 id="6-required-libraries">6. Required Libraries</h2>
<h3 id="core-dependencies">Core Dependencies</h3>
<pre class="hljs"><code><div>jsonschema&gt;=4.17.0          # JSON schema validation
</div></code></pre>
<h3 id="development-dependencies">Development Dependencies</h3>
<pre class="hljs"><code><div>pytest&gt;=7.0.0               # Testing framework
pytest-asyncio&gt;=0.21.0      # Async testing support
pytest-cov&gt;=4.0.0           # Code coverage
</div></code></pre>
<h3 id="optional-dependencies">Optional Dependencies</h3>
<pre class="hljs"><code><div>aiosqlite&gt;=0.19.0           # Async SQLite operations (future enhancement)
python-dotenv&gt;=1.0.0        # Environment variable management
</div></code></pre>
<h3 id="python-standard-library-no-installation-required">Python Standard Library (No Installation Required)</h3>
<pre class="hljs"><code><div>asyncio                     # Async programming
json                       # JSON handling
sqlite3                    # SQLite database
logging                    # Logging system
uuid                       # UUID generation
datetime                   # Date/time operations
typing                     # Type hints
os                         # Operating system interface
sys                        # System-specific parameters
signal                     # Signal handling
</div></code></pre>
<h3 id="complete-requirementstxt">Complete requirements.txt</h3>
<pre class="hljs"><code><div># Core dependencies
jsonschema&gt;=4.17.0

# Development dependencies
pytest&gt;=7.0.0
pytest-asyncio&gt;=0.21.0
pytest-cov&gt;=4.0.0

# Optional dependencies for enhanced features
aiosqlite&gt;=0.19.0
python-dotenv&gt;=1.0.0
</div></code></pre>
<h3 id="installation-commands">Installation Commands</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Install core dependencies only</span>
pip install jsonschema

<span class="hljs-comment"># Install all dependencies including development tools</span>
pip install -r requirements.txt

<span class="hljs-comment"># Install with specific versions (production)</span>
pip install jsonschema==4.17.0 pytest==7.0.0 pytest-asyncio==0.21.0
</div></code></pre>
<hr>
<h2 id="7-sequence-flow">7. Sequence Flow</h2>
<h3 id="71-system-initialization-flow">7.1 System Initialization Flow</h3>
<pre class="hljs"><code><div>1. Application Startup
   â”œâ”€â”€ Load configuration from config/settings.py
   â”œâ”€â”€ Initialize logging system
   â”œâ”€â”€ Create DatabaseManager instance
   â”‚   â”œâ”€â”€ Check if database exists
   â”‚   â””â”€â”€ Initialize database tables
   â”œâ”€â”€ Create MCPServer instance
   â”‚   â”œâ”€â”€ Load tool definitions
   â”‚   â”œâ”€â”€ Load resource definitions
   â”‚   â””â”€â”€ Set up message handlers
   â””â”€â”€ Start TCP server on configured host/port
</div></code></pre>
<h3 id="72-client-connection--handshake-flow">7.2 Client Connection &amp; Handshake Flow</h3>
<pre class="hljs"><code><div>1. Client Connection
   â”œâ”€â”€ TCP connection established
   â”œâ”€â”€ Client sends 'initialize' request
   â”‚   â””â”€â”€ Includes: protocol version, capabilities, client info
   â”œâ”€â”€ Server validates initialization request
   â”œâ”€â”€ Server responds with capabilities
   â”‚   â””â”€â”€ Includes: protocol version, server info, available tools/resources
   â”œâ”€â”€ Client sends 'tools/list' request
   â”œâ”€â”€ Server responds with tool definitions
   â”œâ”€â”€ Client sends 'resources/list' request
   â”œâ”€â”€ Server responds with resource definitions
   â””â”€â”€ Handshake complete - ready for operations
</div></code></pre>
<h3 id="73-database-write-operations-flow">7.3 Database Write Operations Flow</h3>
<pre class="hljs"><code><div>1. Create Usage Log
   â”œâ”€â”€ Client sends 'tools/call' request
   â”‚   â”œâ”€â”€ Method: &quot;tools/call&quot;
   â”‚   â”œâ”€â”€ Tool name: &quot;create_usage_log&quot;
   â”‚   â””â”€â”€ Arguments: {monitor_app_version, platform, user, application_name, 
   â”‚                   application_version, log_date, legacy_app, duration_seconds}
   â”œâ”€â”€ Server validates request against JSON schema
   â”œâ”€â”€ Server extracts tool arguments
   â”œâ”€â”€ DatabaseManager.create_usage_log() called
   â”‚   â”œâ”€â”€ Validate database connection
   â”‚   â”œâ”€â”€ Validate required fields for new schema
   â”‚   â”œâ”€â”€ Convert legacy_app boolean to 1/0 for SQLite
   â”‚   â”œâ”€â”€ Execute INSERT SQL statement
   â”‚   â”œâ”€â”€ Commit transaction
   â”‚   â””â”€â”€ Return new log ID
   â”œâ”€â”€ Server formats response with log ID
   â””â”€â”€ Client receives success response with log ID
</div></code></pre>
<h3 id="74-database-read-operations-flow">7.4 Database Read Operations Flow</h3>
<pre class="hljs"><code><div>1. Retrieve Usage Logs
   â”œâ”€â”€ Client sends 'tools/call' request
   â”‚   â”œâ”€â”€ Method: &quot;tools/call&quot;
   â”‚   â”œâ”€â”€ Tool name: &quot;get_usage_logs&quot;
   â”‚   â””â”€â”€ Arguments: {filters: {application_name: &quot;chrome.exe&quot;}} (optional)
   â”œâ”€â”€ Server validates request
   â”œâ”€â”€ DatabaseManager.get_usage_logs() called
   â”‚   â”œâ”€â”€ Build SELECT query with WHERE clause (if filters)
   â”‚   â”œâ”€â”€ Execute query
   â”‚   â”œâ”€â”€ Convert rows to dictionaries
   â”‚   â”œâ”€â”€ Convert legacy_app from 1/0 to True/False
   â”‚   â””â”€â”€ Return list of log entries
   â”œâ”€â”€ Server formats response with log data
   â””â”€â”€ Client receives log entries
</div></code></pre>
<h3 id="75-database-update-operations-flow">7.5 Database Update Operations Flow</h3>
<pre class="hljs"><code><div>1. Update Usage Log
   â”œâ”€â”€ Client sends 'tools/call' request
   â”‚   â”œâ”€â”€ Tool name: &quot;update_usage_log&quot;
   â”‚   â””â”€â”€ Arguments: {log_id: 123, updates: {user: &quot;new_user&quot;, duration_seconds: 7200}}
   â”œâ”€â”€ Server validates request
   â”œâ”€â”€ DatabaseManager.update_usage_log() called
   â”‚   â”œâ”€â”€ Build UPDATE SQL with SET clause
   â”‚   â”œâ”€â”€ Execute update with log_id WHERE clause
   â”‚   â”œâ”€â”€ Check if any rows were affected
   â”‚   â””â”€â”€ Return success/failure boolean
   â”œâ”€â”€ Server formats response
   â””â”€â”€ Client receives update result
</div></code></pre>
<h3 id="76-database-delete-operations-flow">7.6 Database Delete Operations Flow</h3>
<pre class="hljs"><code><div>1. Delete Usage Log
   â”œâ”€â”€ Client sends 'tools/call' request
   â”‚   â”œâ”€â”€ Tool name: &quot;delete_usage_log&quot;
   â”‚   â””â”€â”€ Arguments: {log_id: 123}
   â”œâ”€â”€ Server validates request
   â”œâ”€â”€ DatabaseManager.delete_usage_log() called
   â”‚   â”œâ”€â”€ Execute DELETE SQL with WHERE clause
   â”‚   â”œâ”€â”€ Check if any rows were affected
   â”‚   â””â”€â”€ Return success/failure boolean
   â”œâ”€â”€ Server formats response
   â””â”€â”€ Client receives deletion result
</div></code></pre>
<h3 id="77-resource-reading-flow">7.7 Resource Reading Flow</h3>
<pre class="hljs"><code><div>1. Read Usage Statistics
   â”œâ”€â”€ Client sends 'resources/read' request
   â”‚   â””â”€â”€ URI: &quot;usage://stats&quot;
   â”œâ”€â”€ Server validates request
   â”œâ”€â”€ Server calls get_usage_logs() to count total logs
   â”œâ”€â”€ Server generates statistics object
   â”‚   â”œâ”€â”€ total_logs: count
   â”‚   â”œâ”€â”€ last_updated: current timestamp
   â”‚   â””â”€â”€ summary: description
   â”œâ”€â”€ Server formats resource response
   â”‚   â”œâ”€â”€ URI: original request URI
   â”‚   â”œâ”€â”€ mimeType: &quot;application/json&quot;
   â”‚   â””â”€â”€ text: JSON-formatted statistics
   â””â”€â”€ Client receives statistics data
</div></code></pre>
<h3 id="77-new-features-duration-aggregation--unique-values">7.7 New Features (Duration Aggregation &amp; Unique Values)</h3>
<h4 id="771-duration-aggregation-flow">7.7.1 Duration Aggregation Flow</h4>
<pre class="hljs"><code><div>1. Create Usage Log with Duplicate Detection
   â”œâ”€â”€ Client sends 'tools/call' request with log data
   â”œâ”€â”€ DatabaseManager.create_usage_log() called
   â”‚   â”œâ”€â”€ Check for existing record with same date, user, application_name
   â”‚   â”œâ”€â”€ If duplicate found:
   â”‚   â”‚   â”œâ”€â”€ Retrieve existing duration_seconds
   â”‚   â”‚   â”œâ”€â”€ Add new duration to existing duration
   â”‚   â”‚   â”œâ”€â”€ Update record with new total duration
   â”‚   â”‚   â”œâ”€â”€ Update other fields (monitor_app_version, platform, etc.)
   â”‚   â”‚   â””â”€â”€ Return existing record ID
   â”‚   â””â”€â”€ If no duplicate:
   â”‚       â”œâ”€â”€ Insert new record as normal
   â”‚       â””â”€â”€ Return new record ID
   â””â”€â”€ Client receives log ID (same ID if aggregated)
</div></code></pre>
<h4 id="772-unique-values-retrieval-flow">7.7.2 Unique Values Retrieval Flow</h4>
<pre class="hljs"><code><div>1. Get Unique Users
   â”œâ”€â”€ Client sends 'tools/call' request
   â”‚   â””â”€â”€ Tool name: &quot;get_unique_users&quot;
   â”œâ”€â”€ DatabaseManager.get_unique_users() called
   â”‚   â”œâ”€â”€ Execute: SELECT DISTINCT user FROM usage_data ORDER BY user
   â”‚   â””â”€â”€ Return sorted list of unique users
   â””â”€â”€ Client receives: [&quot;alice&quot;, &quot;bob&quot;, &quot;john_doe&quot;]

2. Get Unique Applications  
   â”œâ”€â”€ Client sends 'tools/call' request
   â”‚   â””â”€â”€ Tool name: &quot;get_unique_applications&quot;
   â”œâ”€â”€ DatabaseManager.get_unique_applications() called
   â”‚   â”œâ”€â”€ Execute: SELECT DISTINCT application_name FROM usage_data ORDER BY application_name
   â”‚   â””â”€â”€ Return sorted list of unique applications
   â””â”€â”€ Client receives: [&quot;chrome.exe&quot;, &quot;firefox.exe&quot;, &quot;vscode.exe&quot;]

3. Get Unique Platforms
   â”œâ”€â”€ Client sends 'tools/call' request
   â”‚   â””â”€â”€ Tool name: &quot;get_unique_platforms&quot; 
   â”œâ”€â”€ DatabaseManager.get_unique_platforms() called
   â”‚   â”œâ”€â”€ Execute: SELECT DISTINCT platform FROM usage_data ORDER BY platform
   â”‚   â””â”€â”€ Return sorted list of unique platforms
   â””â”€â”€ Client receives: [&quot;Linux&quot;, &quot;Windows&quot;, &quot;macOS&quot;]
</div></code></pre>
<h4 id="773-updated-data-format">7.7.3 Updated Data Format</h4>
<pre class="hljs"><code><div>- log_date format changed from ISO 8601 timestamp to YYYY-MM-DD
- Composite indexes added for better DISTINCT query performance:
  â”œâ”€â”€ idx_user_date (user, log_date)
  â”œâ”€â”€ idx_app_platform (application_name, platform)  
  â””â”€â”€ idx_platform_date (platform, log_date)
</div></code></pre>
<h3 id="78-error-handling-flow">7.8 Error Handling Flow</h3>
<pre class="hljs"><code><div>1. Error Scenarios
   â”œâ”€â”€ JSON Parse Error
   â”‚   â”œâ”€â”€ Invalid JSON received
   â”‚   â”œâ”€â”€ Server responds with -32700 error code
   â”‚   â””â”€â”€ Connection remains open
   â”œâ”€â”€ Invalid Request
   â”‚   â”œâ”€â”€ Missing required fields
   â”‚   â”œâ”€â”€ Server responds with -32600 error code
   â”‚   â””â”€â”€ Request rejected
   â”œâ”€â”€ Method Not Found
   â”‚   â”œâ”€â”€ Unknown tool or method
   â”‚   â”œâ”€â”€ Server responds with -32601 error code
   â”‚   â””â”€â”€ Available methods logged
   â”œâ”€â”€ Invalid Parameters
   â”‚   â”œâ”€â”€ Schema validation fails
   â”‚   â”œâ”€â”€ Server responds with -32602 error code
   â”‚   â””â”€â”€ Validation error details included
   â””â”€â”€ Internal Error
       â”œâ”€â”€ Database or server error
       â”œâ”€â”€ Server responds with -32603 error code
       â”œâ”€â”€ Error logged for debugging
       â””â”€â”€ Generic error message to client
</div></code></pre>
<h3 id="79-connection-lifecycle-flow">7.9 Connection Lifecycle Flow</h3>
<pre class="hljs"><code><div>1. Connection Management
   â”œâ”€â”€ Connection Established
   â”‚   â”œâ”€â”€ TCP socket created
   â”‚   â”œâ”€â”€ Client address logged
   â”‚   â””â”€â”€ Handshake initiated
   â”œâ”€â”€ Active Session
   â”‚   â”œâ”€â”€ Message processing loop
   â”‚   â”œâ”€â”€ Request/response cycles
   â”‚   â””â”€â”€ Error handling
   â”œâ”€â”€ Graceful Shutdown
   â”‚   â”œâ”€â”€ Client closes connection
   â”‚   â”œâ”€â”€ Server detects connection closure
   â”‚   â”œâ”€â”€ Cleanup resources
   â”‚   â””â”€â”€ Log connection closure
   â””â”€â”€ Error Shutdown
       â”œâ”€â”€ Network error or exception
       â”œâ”€â”€ Server catches exception
       â”œâ”€â”€ Force close connection
       â”œâ”€â”€ Log error details
       â””â”€â”€ Cleanup resources
</div></code></pre>
<hr>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><strong>API Examples</strong>: <code>examples/client_usage.py</code></li>
<li><strong>Server Startup</strong>: <code>examples/start_server.py</code></li>
<li><strong>Configuration Guide</strong>: <code>config/settings.py</code></li>
<li><strong>Database Schema</strong>: <code>database/schema.sql</code></li>
</ul>
<hr>
<p><strong>Status</strong>: âœ… Production Ready | <strong>Protocol Version</strong>: 2024-11-05 | <strong>Last Updated</strong>: July 27, 2025</p>

</body>
</html>
